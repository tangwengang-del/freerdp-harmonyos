# 完整签名配置步骤

## ✅ 已完成的准备工作

- ✅ 包名已修改为：`com.example.twgapplication`（匹配华为项目）
- ✅ 华为 AGC 项目已创建
  - 项目名称：twg
  - 项目 ID：101653523863457729
  - 应用包名：com.example.twgapplication

## 📋 现在需要做的步骤

### 第 1 步：在华为 AGC 平台生成签名证书

#### 1.1 登录 AppGallery Connect
```
https://developer.huawei.com/consumer/cn/service/josp/agc/index.html
```

#### 1.2 进入您的项目
- 项目名称：**twg**
- 找到应用：**com.example.twgapplication**

#### 1.3 进入证书管理

在左侧菜单或应用设置中找到：
- **"HarmonyOS应用"** 或 **"HarmonyOS App"**
- 点击进入应用详情
- 找到 **"签名"** 或 **"Signing Configs"** 或 **"证书"** 选项

#### 1.4 生成调试证书

1. 点击 **"生成调试证书"** 或 **"Generate Debug Certificate"**

2. 填写信息：
   ```
   证书类型：调试证书 (Debug Certificate)
   密钥别名：1 或 debugKey
   密码：123456  ⚠️ 这次一定要记住！
   ```

3. 点击生成

#### 1.5 下载签名文件

生成成功后，下载以下三个文件：
- **xxx.p12** → 重命名为 `debug.p12`
- **xxx.cer** → 重命名为 `debug.cer`
- **xxx.p7b** → 重命名为 `debug.p7b`

---

### 第 2 步：放置签名文件到项目

#### 2.1 备份旧文件（如果有）

```powershell
# 在 PowerShell 中运行
cd c:\huawei
Move-Item .signing .signing_old -ErrorAction SilentlyContinue
```

#### 2.2 创建新的签名目录

```powershell
New-Item -ItemType Directory -Path .signing -Force
```

#### 2.3 复制下载的文件

将下载并重命名的三个文件复制到：
```
c:\huawei\.signing\
├── debug.p12
├── debug.cer
└── debug.p7b
```

#### 2.4 验证文件

```powershell
Get-ChildItem .signing\debug.* | Select-Object Name, Length
```

应该看到三个文件，大小都大于 1KB。

---

### 第 3 步：在 DevEco Studio 配置签名

#### 3.1 打开签名配置

在 DevEco Studio 中：
```
File → Project Structure → Signing Configs
```

#### 3.2 配置签名材料

在右侧面板填写：

| 字段 | 值 |
|------|-----|
| Support HarmonyOS | ✅ 勾选 |
| Store File(.p12) | 点击 [...] 选择 `c:\huawei\.signing\debug.p12` |
| Store Password | 输入：`123456`（您设置的密码） |
| Key Alias | 输入：`1` 或 `debugKey` |
| Key Password | 输入：`123456`（与 Store Password 相同） |
| Profile | 点击 [...] 选择 `c:\huawei\.signing\debug.p7b` |
| Certpath | 点击 [...] 选择 `c:\huawei\.signing\debug.cer` |
| Sign Alg | 选择：`SHA256withECDSA` |

#### 3.3 保存配置

点击 **Apply** 然后 **OK**

---

### 第 4 步：构建应用

#### 4.1 清理项目（可选）

```
Build → Clean Project
```

#### 4.2 构建 HAP

```
Build → Build Hap(s) / APP(s) → Build Hap(s)
```

或按快捷键：**Ctrl + F9**

#### 4.3 等待构建完成

如果看到：
```
> hvigor BUILD SUCCESSFUL
```

说明构建成功！

---

### 第 5 步：找到并验证 HAP 文件

#### 5.1 HAP 文件位置

```
c:\huawei\entry\build\default\outputs\default\entry-default-signed.hap
```

#### 5.2 验证文件

在 PowerShell 中运行：

```powershell
$hap = "entry\build\default\outputs\default\entry-default-signed.hap"
if (Test-Path $hap) {
    $info = Get-Item $hap
    Write-Host "✓ HAP 文件已生成" -ForegroundColor Green
    Write-Host "  路径: $($info.FullName)" -ForegroundColor White
    $sizeMB = [math]::Round($info.Length / 1MB, 2)
    Write-Host "  大小: ${sizeMB} MB" -ForegroundColor White
    Write-Host ""
    Write-Host "现在可以上传到服务器测试了！" -ForegroundColor Cyan
} else {
    Write-Host "✗ HAP 文件未找到" -ForegroundColor Red
}
```

---

## 🎉 完成！

如果一切顺利，您现在有了：

✅ 签名配置完成  
✅ HAP 文件已生成  
✅ 可以上传到服务器测试

---

## 📤 上传到服务器

### 使用 SCP（如果有 SSH）

```powershell
scp entry\build\default\outputs\default\entry-default-signed.hap user@server:/path/
```

### 使用 FTP

使用 FTP 客户端（如 FileZilla）上传 HAP 文件。

### 在测试服务器上安装

```bash
hdc install entry-default-signed.hap
```

---

## ❓ 常见问题

### Q1: 找不到"签名"或"证书"选项？

A: 在 AGC 控制台中：
1. 点击项目 "twg"
2. 点击应用 "com.example.twgapplication"
3. 查找以下可能的位置：
   - "HarmonyOS应用" → "签名配置"
   - "应用信息" → "证书管理"
   - 左侧菜单 → "Signing"
   - 如果找不到，尝试在应用详情页面查找"配置"或"设置"标签

### Q2: 生成证书时提示需要设备？

A: 
- 调试证书通常可以选择"所有设备"或"不限设备"
- 如果必须绑定设备，可以：
  1. 选择"稍后配置设备"
  2. 或使用任意设备ID占位

### Q3: 下载的文件名不是 debug.xxx？

A: 
- 没关系，下载后手动重命名即可
- 重要的是文件内容，不是文件名

### Q4: 构建还是失败？

A: 
1. 确认密码正确（就是您生成时设置的密码）
2. 确认三个文件都在 `.signing` 目录
3. 确认在 DevEco Studio 中重新配置了签名
4. 尝试 Clean Project 后重新构建

---

## 🔄 如果失败了

### 检查清单

- [ ] 华为 AGC 项目包名是 `com.example.twgapplication`
- [ ] 本地项目包名已改为 `com.example.twgapplication`
- [ ] 签名证书已生成并下载
- [ ] 三个文件都在 `.signing` 目录
- [ ] DevEco Studio 中配置了签名
- [ ] 密码输入正确

### 重试步骤

如果还是不行：

1. 在华为平台删除旧证书
2. 重新生成（密码：`123456`）
3. 重新下载文件
4. 清理 DevEco Studio 缓存
5. 重新配置
6. 重新构建

---

## 📞 需要帮助

如果按照步骤操作后仍有问题，请提供：
1. 在哪一步失败了
2. 具体的错误信息
3. 截图（如果方便）

我会继续协助您解决！

---

**现在开始第 1 步：在华为 AGC 平台生成签名证书！** 🚀
